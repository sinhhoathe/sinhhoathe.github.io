<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω h·ªôi ngh·ªã - Ban T·ªï ch·ª©c</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <style>
        body {
            background: #f5f5f5;
            min-height: 100vh;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .navbar-item, .navbar-link {
            color: white !important;
        }
        .conference-card {
            margin-bottom: 1.5rem;
            transition: transform 0.2s;
            cursor: pointer;
        }
        .conference-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .conference-card.is-active {
            border: 3px solid #667eea;
        }
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar" role="navigation">
        <div class="navbar-brand">
            <div class="navbar-item">
                <strong style="color: white;">üéØ Qu·∫£n l√Ω h·ªôi ngh·ªã</strong>
            </div>
            <!-- Burger Menu for Mobile -->
            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarMenu" style="color: white;">
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
            </a>
        </div>
        
        <div id="navbarMenu" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <span style="color: white(0,0,0,0.7); margin-right: 1rem;" class="is-hidden-touch">üë§ <span id="usernameDisplay"></span></span>
                    <!-- Mobile only username display if needed, but keeping simple -->
                </div>
                <div class="navbar-item">
                    <span class="is-hidden-desktop" style="margin-right: 10px; font-weight: bold;">üë§ <span id="mobileUsernameDisplay"></span></span>
                    <button class="button is-light is-small" id="logoutBtn">
                        üö™ ƒêƒÉng xu·∫•t
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Check Script -->
    <script>
        // Toggle Mobile Menu
        document.addEventListener('DOMContentLoaded', () => {
            const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
            if ($navbarBurgers.length > 0) {
                $navbarBurgers.forEach( el => {
                    el.addEventListener('click', () => {
                        const target = el.dataset.target;
                        const $target = document.getElementById(target);
                        el.classList.toggle('is-active');
                        $target.classList.toggle('is-active');
                    });
                });
            }
        });

        // Check if logged in
        if (sessionStorage.getItem('btc_logged_in') !== 'true') {
            window.location.href = 'login.html';
        }
        
        // Display username
        const username = sessionStorage.getItem('btc_username') || 'Admin';
        document.getElementById('usernameDisplay').textContent = username;
        if(document.getElementById('mobileUsernameDisplay')) {
             document.getElementById('mobileUsernameDisplay').textContent = username;
        }
        
        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', () => {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                sessionStorage.clear();
                window.location.href = 'login.html';
            }
        });
    </script>

    <section class="section">
        <div class="container">
            <!-- Header -->
            <div class="level">
                <div class="level-left">
                    <div class="level-item">
                        <h1 class="title">üìã Danh s√°ch h·ªôi ngh·ªã</h1>
                    </div>
                </div>
                <div class="level-right">
                    <div class="level-item">
                        <button class="button is-primary" id="btnCreateConference">
                            ‚ûï T·∫°o h·ªôi ngh·ªã m·ªõi
                        </button>
                    </div>
                </div>
            </div>

            <!-- Conference List -->
            <div id="conferenceList" class="columns is-multiline">
                <div class="column is-12">
                    <div class="has-text-centered" style="padding: 3rem;">
                        <p class="has-text-grey">ƒêang t·∫£i danh s√°ch h·ªôi ngh·ªã...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal Create/Edit Conference -->
    <div class="modal" id="conferenceModal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head" style="background: #667eea;">
                <p class="modal-card-title" style="color: white;" id="modalTitle">T·∫°o h·ªôi ngh·ªã m·ªõi</p>
                <button class="delete" aria-label="close" id="closeModal"></button>
            </header>
            <section class="modal-card-body">
                <form id="conferenceForm">
                    <div class="field">
                        <label class="label">T√™n h·ªôi ngh·ªã <span style="color: red;">*</span></label>
                        <div class="control">
                            <input class="input" type="text" id="conferenceName" placeholder="H·ªôi ngh·ªã T·ªïng k·∫øt 2026" required>
                        </div>
                    </div>


                    <div class="columns">
                        <div class="column is-6">
                            <div class="field">
                                <label class="label">Vƒ© ƒë·ªô (Latitude)</label>
                                <div class="control">
                                    <input class="input" type="number" step="0.000001" id="latitude" placeholder="21.0285">
                                </div>
                            </div>
                        </div>
                        <div class="column is-6">
                            <div class="field">
                                <label class="label">Kinh ƒë·ªô (Longitude)</label>
                                <div class="control">
                                    <input class="input" type="number" step="0.000001" id="longitude" placeholder="105.8542">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">B√°n k√≠nh cho ph√©p (m√©t)</label>
                        <div class="control">
                            <input class="input" type="number" id="radius" placeholder="100" value="100">
                        </div>
                    </div>

                    <div class="columns">
                        <div class="column is-6">
                            <div class="field">
                                <label class="label">Th·ªùi gian b·∫Øt ƒë·∫ßu</label>
                                <div class="control">
                                    <input class="input" type="datetime-local" id="startTime">
                                </div>
                            </div>
                        </div>
                        <div class="column is-6">
                            <div class="field">
                                <label class="label">Th·ªùi gian k·∫øt th√∫c</label>
                                <div class="control">
                                    <input class="input" type="datetime-local" id="endTime">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <label class="checkbox">
                                <input type="checkbox" id="isOpen">
                                <strong> M·ªü ƒëi·ªÉm danh</strong>
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <button type="button" class="button is-info is-small" id="getCurrentLocation">
                                üìç L·∫•y v·ªã tr√≠ hi·ªán t·∫°i
                            </button>
                        </div>
                    </div>
                </form>
            </section>
            <footer class="modal-card-foot">
                <button class="button is-success" id="btnSaveConference">üíæ L∆∞u</button>
                <button class="button" id="btnCancelModal">H·ªßy</button>
            </footer>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div class="modal" id="qrModal">
        <div class="modal-background"></div>
        <div class="modal-card" style="width: 320px;">
            <header class="modal-card-head" style="background: #667eea;">
                <p class="modal-card-title" style="color: white; font-size: 1rem;">M√£ QR ƒêi·ªÉm Danh</p>
                <button class="delete" aria-label="close" id="closeQrModal"></button>
            </header>
            <section class="modal-card-body" style="text-align: center; padding: 2rem;">
                <div id="qrcode" style="display: flex; justify-content: center;"></div>
                <p style="margin-top: 1rem; font-weight: bold; color: #667eea;" id="qrConfName"></p>
                <p style="font-size: 0.8rem; color: #888;">Qu√©t m√£ ƒë·ªÉ ƒëi·ªÉm danh</p>
            </section>
            <footer class="modal-card-foot" style="justify-content: center;">
                <button class="button is-info is-small" id="downloadQr">‚¨áÔ∏è T·∫£i ·∫£nh m√£ QR</button>
            </footer>
        </div>
    </div>

    <!-- QR Code Library & Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="firebase.config.js"></script>
    <script src="btc-list.js"></script>
</body>
</html>
